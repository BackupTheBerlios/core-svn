<?php

header("Content-type: application/xml");

echo('<?xml version="1.0" encoding="iso-8859-2"?>');
echo "\n<rss version=\"2.0\">\n\n";

define("PATH_TO_CLASSES", "administration/classes");
define("PATH_TO_CONFIG", "administration/inc");

require(PATH_TO_CLASSES. "/cls_db_mysql.inc"); // dodawanie pliku konfigurujacego bibliotekê baz danych
require(PATH_TO_CONFIG. "/config.php");
	
// warto¶æ pocz±tkowa zmiennej $start -> potrzebna przy stronnicowaniu
$start = ( isset($_GET['start']) ) ? intval($_GET['start']) : 0;

include("inc/main_pagination.php");

$data_base = new MySQL_DB;
$data_base->query("	SELECT b.*, a.id, a.title 
					FROM $mysql_data[db_table_comments] b 
					LEFT JOIN $mysql_data[db_table] a 
					ON b.comments_id = a.id 
					GROUP BY date 
					DESC LIMIT 10");

echo "	
<channel>
	<title>./dev-log - comments RSS feed</title>
	<link>http://dev.no1-else.com</link>
	<description>./dev-log | about work</description>
	<language>pl</language> 
	<copyright>Copyright (c) 2004 core | £ukasz Skowroñ</copyright>
";

while($data_base->next_record()) {
	
	$date 			= $data_base->f("date");
	$title 			= $data_base->f("title");
	$text 			= $data_base->f("text");
	$author 		= $data_base->f("author");
	$id 			= $data_base->f("id");
	$c_id			= $data_base->f("c_id");
	$image			= $data_base->f("image");
	$comments_allow = $data_base->f("comments_allow");
	
	$c_name = $data_base->f("category_name");
	$c_id 	= $data_base->f("category_id");
	 
	// Przypisanie zmiennej $comments
	$comments 	= $data_base->f("comments");
	
	// zmiana formatu wy¶wietlania daty
	$newdate	= explode(' ', $date);
	
	$date_ex	= explode('-', $newdate[0]);
	if($date_ex[1] == '01') $date_ex[1] = "Jan";
	if($date_ex[1] == '02') $date_ex[1] = "Feb";
	if($date_ex[1] == '03') $date_ex[1] = "Mar";
	if($date_ex[1] == '04') $date_ex[1] = "Apr";
	if($date_ex[1] == '05') $date_ex[1] = "May";
	if($date_ex[1] == '06') $date_ex[1] = "Jun";
	if($date_ex[1] == '07') $date_ex[1] = "Jul";
	if($date_ex[1] == '08') $date_ex[1] = "Aug";
	if($date_ex[1] == '09') $date_ex[1] = "Sep";
	if($date_ex[1] == '10') $date_ex[1] = "Oct";
	if($date_ex[1] == '11') $date_ex[1] = "Nov";
	if($date_ex[1] == '12') $date_ex[1] = "Dec";
	
	$date		= $date_ex[2] . " " . $date_ex[1] . " " . $date_ex[0] . " " . $newdate[1];
	
	$text = strip_tags($text, '<br><a>');
	
	$text	= ereg_replace("&", " &amp; ", $text);
	$text	= ereg_replace("<br />", "&lt;br /&gt;", $text);
	
	$text	= ereg_replace("<", "&lt;", $text);
	$text	= ereg_replace(">", "&gt;", $text);
	
	$c_name	= ereg_replace("&", " and ", $c_name);

	
	echo "<item>\n";
	echo "	<pubDate>" . $date . " GMT</pubDate>\n";
	echo "	<title>" . $title . "</title>\n";
	echo "	<link>http://dev.no1-else.com/1," . $id . ",1,item.html</link>\n";
	echo "	<description>" . $text . "&lt;br /&gt;&lt;br /&gt;&lt;b&gt;" . $author . "&lt;/b&gt;</description>\n";
	echo "</item>\n\n";
}

echo "</channel>\n\n";
echo "</rss>"
?>