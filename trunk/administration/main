<?php

session_register("login");
session_register("password");
session_register("loggedIn");

if(!isset($_SESSION["loggedIn"])){
	
	header("Location: index");
	exit;
}

// warto¶æ pocz±tkowa zmiennej $start -> potrzebna przy stronnicowaniu
$start = ( isset($_GET['start']) ) ? intval($_GET['start']) : 0;

require("classes/cls_db_mysql.inc"); // dodawanie pliku konfigurujacego bibliotekê baz danych
require("classes/cls_upload.php"); // dodawanie pliku konfigurujacego bibliotekê uploadu plików
require("classes/cls_phpmailer.php"); // dodawanie pliku konfigurujacego bibliotekê wysy³ania mail'i
require("inc/config.php");
include("../inc/main_pagination.php");
include("../inc/main_functions.php");
require("classes/cls_fast_template.php");

// inicjowanie klasy, wkazanie katalogu przechowuj±cego szablony
$ft = new FastTemplate("./templates");

// tablica definicji u¿ytych plików *.tpl
$ft->define(array(	// g³ówne szablony parsowane w celu wy¶wietlenia strony
					'index' 					=>"index.tpl",
					'main_loader'				=>"main_loader.tpl",
					'main_site'					=>"main_site.tpl",
					
					// szablon obs³uguj±cy error handlera, jak i dodatkowe komunikaty
					'result_note'				=>"result_note.tpl"));
		
$ft->assign(array(	'TITLE'				=>"CORE - panel administracyjny",
					'LOGGED_IN'			=>$_SESSION['login']));


$inc_modules = array(
		"header_menu",
		"subcat_menu");

foreach($inc_modules as $module) {
	
	// ³adowanie dodatkowych modu³ów
	include('modules/' . $module . '.php');
}

// prze³±cznica ³adowanej tre¶ci					
$p = empty($_GET['p']) ? '' : $_GET['p'];
switch($p){
	
	// dodawanie kolejnego wpisu
	case '1': 
		include('modules/add_note.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;

	// edycja/usuwanie istniej±cych wpisów
	case '2': 
		include('modules/edit_note.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// dodawanie kolejnej strony
	case '3': 
		include('modules/add_page.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;

	// edycja/usuwanie istniej±cych wpisów
	case '4': 
		include('modules/edit_page.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// edycja/usuwanie istniej±cych komentarzy
	case '5': 
		include('modules/edit_comments.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// statystycznie najczê¶ciej komentowane wpisy
	case '6': 
		include('modules/most_comments.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;	
		
	// dodanie nowego u¿ytkownika systemu	
	case '7': 
		include('modules/add_user.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// dodanie nowej kategorii	
	case '8': 
		include('modules/add_category.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// edycja|usuwanie istniej±cych kategorii	
	case '9': 
		include('modules/edit_category.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// konfiguracja core	
	case '10': 
		include('modules/core_configuration.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// dodanie nowego linku	
	case '11': 
		include('modules/add_links.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// edycja|usuwanie istniej±cych linków	
	case '12': 
		include('modules/edit_links.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
		
	// edycja|usuwanie u¿ytkowników	
	case '13': 
		include('modules/edit_users.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;	
	
	// domy¶lnie	
	default:
		include('modules/main.php');
		$ft->parse('MAIN', array("main_loader", "index"));
		break;
}	

$ft->FastPrint();
exit;
?>
